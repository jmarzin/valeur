%p#notice= notice

%h2 Coûts indirects d'investissement de l'étude  #{@etude._id} du projet #{@etude.projet.nom}
%header
  = link_to 'Modif', edit_indirect_path(@etude)
  \|
  = link_to 'Rentabilité', rentabilite_path(@etude)
  \|
  = link_to 'Etude', projet_etude_path(@etude.projet, @etude)
%br
%br
%article#indirect_part_cadre
  %table#indirect_part_cadre
    %tr
      %th.categorie Catégorie de personnel
      %th.repart Répartition (%)
    %tr
      %td.categorie A+
      %td.repart= @etude.etude_rentabilite.indirect.cat_aplus
    %tr
      %td.categorie A
      %td.repart= @etude.etude_rentabilite.indirect.cat_a
    %tr
      %td.categorie B
      %td.repart= @etude.etude_rentabilite.indirect.cat_b
    %tr
      %td.categorie C
      %td.repart= @etude.etude_rentabilite.indirect.cat_c
%br
%br
%article.indirect_detail
  %table.indirect_detail
    %th.description Description du coût
    %th.nature Nature
    %th.unite Exprimé en
    %th.totaux --Totaux-- 
    -@etude.etude_rentabilite.indirect.calculees[0].montants.each do |mt|
      %th=mt.annee
    -@etude.etude_rentabilite.indirect.details.each do |det|
      %tr
        %td.description= det.description
        %td.nature=det.nature
        %td.unite=det.unite
        %td.totaux.montant=number_with_precision(det.total,options =  {delimiter: " ", precision: 0})
        -i = 0
        -@etude.etude_rentabilite.indirect.calculees[0].montants.each do |calc|
          -if det.montants[i] && det.montants[i].annee == calc.annee then
            %td.montant=number_with_precision(det.montants[i].montant, options = {delimiter: " ", precision: 0})
            -i += 1
          -else
            %td
    -@etude.etude_rentabilite.indirect.calculees.each do |calc|
      %tr
        %td.description{:colspan => 2}= calc.description
        %td.unite=calc.unite
        %td.montant=number_with_precision(calc.total, options =  {delimiter: " ", precision: 0})
        -@etude.etude_rentabilite.indirect.calculees[0].montants.each do |mt|
          %td.montant= number_with_precision(mt.montant, options =  {delimiter: " ", precision: 0})
%br
%br
%article.indirect_somme
  %table.indirect_somme
    %tr
      %th.nature{:colspan => 2} Coûts directs pluriannuels 
      %th (k€)
      %th.commentaire Commentaires
    - @etude.etude_rentabilite.indirect.sommes.each do |somme|
      %tr
        %td.nature= somme.nature
        %td.unite= somme.unite
        %td.montant= number_with_precision(somme.montant, options = {delimiter: " ", precision: 0}) unless somme.montant == 0
        %td.commentaire= somme.commentaire
%br
%br
%footer
  = link_to 'Modif', edit_indirect_path(@etude)
  \|
  = link_to 'Rentabilité', rentabilite_path(@etude)
  \|
  = link_to 'Etude', projet_etude_path(@etude.projet, @etude)
